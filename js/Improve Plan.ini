ä¸ºäº†å®ç° ã€Œæ¸¸æˆè¿›åº¦ + æç¤ºè§£é”ã€ï¼Œä½ åªéœ€è¦ï¼š

ç›®æ ‡	éœ€è¦æ”¹çš„æ–‡ä»¶
å®šä¹‰â€œè¿›åº¦ / é‡Œç¨‹ç¢‘ / æç¤ºâ€	stories.js
è®°å½• & æ›´æ–°è¿›åº¦çŠ¶æ€	game_logic.jsï¼ˆæ ¸å¿ƒï¼‰
æ¯è½®é—®ç­”åè§¦å‘è¿›åº¦åˆ¤å®š	app.js
ï¼ˆå¯é€‰ï¼‰ç”¨ AI åˆ¤å®šè¿›åº¦	ai_client.js
æ˜¾ç¤ºè¿›åº¦ / æç¤º	index.html + style.cssï¼ˆè½»æ”¹ï¼‰

ä¸‹é¢æˆ‘ä¸€å±‚ä¸€å±‚æ‹†ã€‚

ä¸€ã€ç¬¬ä¸€æ­¥ï¼šè®©â€œæ•…äº‹â€æ”¯æŒè¿›åº¦ï¼ˆæ”¹ stories.jsï¼‰
ä½ ç°åœ¨çš„é—®é¢˜

åœ¨ stories.js é‡Œï¼ˆ

stories

ï¼‰ï¼š

{
  puzzle,
  truth,
  hint
}


è¿™é‡Œåªæœ‰ï¼š

ä¸€ä¸ªæœ€ç»ˆçœŸç›¸

ä¸€ä¸ªæ¨¡ç³Š hint

ğŸ‘‰ ç³»ç»Ÿæ ¹æœ¬ä¸çŸ¥é“â€œç©å®¶æ¨è¿›åˆ°å“ªä¸€æ­¥äº†â€

âœ… åº”è¯¥æ€ä¹ˆæ”¹ï¼ˆæœ€é‡è¦çš„ä¸€æ­¥ï¼‰

ç»™æ¯ä¸ªæ•…äº‹åŠ ä¸€ä¸ª solutionSpecï¼ˆåªç»™ç³»ç»Ÿç”¨ï¼Œç©å®¶çœ‹ä¸åˆ°ï¼‰ï¼š

ç¤ºä¾‹ï¼ˆä»¥â€œæµ·é¾Ÿæ±¤â€ä¸ºä¾‹ï¼‰
{
  id: 'soup1',
  title: 'æµ·é¾Ÿæ±¤',
  puzzle: '...',
  truth: '...',
  solutionSpec: {
    milestones: [
      { id: 'm1', must: true, text: 'äº‹æƒ…ä¸æµ·éš¾æœ‰å…³' },
      { id: 'm2', must: true, text: 'ä»–æ›¾ç»åƒè¿‡äººè‚‰' },
      { id: 'm3', must: true, text: 'ç°åœ¨å–çš„æ˜¯çœŸæ­£çš„æµ·é¾Ÿæ±¤' },
      { id: 'm4', must: true, text: 'æ„è¯†åˆ°çœŸç›¸åè‡ªæ€' }
    ],
    hints: [
      { id: 'h1', unlockAfter: 1, text: 'é‡ç‚¹ä¸æ˜¯ç°åœ¨ï¼Œè€Œæ˜¯è¿‡å»çš„ç»å†ã€‚' },
      { id: 'h2', unlockAfter: 2, text: 'æ³¨æ„â€œåƒçš„æ˜¯ä»€ä¹ˆâ€å’Œâ€œå‘³é“â€ã€‚' },
      { id: 'h3', unlockAfter: 3, text: 'è¿™ä¸æ˜¯è°‹æ€ï¼Œæ˜¯å¿ƒç†å´©æºƒã€‚' }
    ]
  }
}

ğŸ§  ä¸ºä»€ä¹ˆè¿™æ ·æ”¹

milestones = â€œå…³é”®äº‹å®â€

unlockAfter = â€œè§£é”èŠ‚å¥â€

ä½ ä¸å†é  AI â€œéšç¼˜è¯´æ­å–œâ€

ğŸ¯ è¾¾åˆ°çš„æ•ˆæœ

æ¸¸æˆè¿›åº¦å¯è®¡ç®—

æç¤ºå¯æ§

ä¸ºåé¢æ‰€æœ‰é€»è¾‘æ‰“åœ°åŸº

äºŒã€ç¬¬äºŒæ­¥ï¼šè®©æ¸¸æˆâ€œè®°å¾—è¿›åº¦â€ï¼ˆæ”¹ game_logic.jsï¼‰

è¿™æ˜¯æ ¸å¿ƒæ–‡ä»¶ï¼ˆ

game_logic

ï¼‰ã€‚

ä½ ç°åœ¨çš„ GameLogic å¤ªâ€œè–„â€

ç°åœ¨åªæœ‰ï¼š

this.history = [];
this.isSolved = false;


âŒ æ²¡æœ‰ï¼š

è¿›åº¦

é‡Œç¨‹ç¢‘

æç¤ºçŠ¶æ€

âœ… åº”è¯¥æ€ä¹ˆæ”¹ï¼ˆæœ€å°ä¾µå…¥ï¼‰
1ï¸âƒ£ åœ¨ constructor é‡ŒåŠ çŠ¶æ€
this.progress = {
  foundMilestones: new Set(),
  unlockedHints: new Set()
};

2ï¸âƒ£ åœ¨ start(story) é‡Œåˆå§‹åŒ–
this.progress.foundMilestones.clear();
this.progress.unlockedHints.clear();

3ï¸âƒ£ æ–°å¢ä¸€ä¸ªæ–¹æ³•ï¼šæ›´æ–°è¿›åº¦
updateProgress(question, answer) {
  const spec = this.currentStory.solutionSpec;
  if (!spec) return;

  spec.milestones.forEach(m => {
    if (this.progress.foundMilestones.has(m.id)) return;

    // ç®€åŒ–ç‰ˆè§„åˆ™ï¼šåªè¦é—®é¢˜å‘½ä¸­å…³é”®è¯ + å›ç­”æ˜¯â€œæ˜¯/æ˜¯ä¹Ÿä¸æ˜¯â€
    if (
      answer !== 'ä¸æ˜¯' &&
      answer !== 'ä¸æ­¤æ— å…³' &&
      question.includes(m.text.slice(0, 2)) // ä½ åé¢å¯ä»¥æ¢æˆ AI åˆ¤å®š
    ) {
      this.progress.foundMilestones.add(m.id);
    }
  });

  // è§£é”æç¤º
  spec.hints.forEach(h => {
    if (this.progress.unlockedHints.has(h.id)) return;
    if (this.progress.foundMilestones.size >= h.unlockAfter) {
      this.progress.unlockedHints.add(h.id);
    }
  });
}

ğŸ§  ä¸ºä»€ä¹ˆè¿™æ ·æ”¹

GameLogic æ˜¯å”¯ä¸€çš„â€œè£åˆ¤â€

AI åªå›ç­”â€œæ˜¯ / ä¸æ˜¯â€

è¿›åº¦ç”±ç³»ç»ŸæŒæ§ï¼Œä¸äº¤ç»™ AI

ğŸ¯ è¾¾åˆ°çš„æ•ˆæœ

æ¯è½®é—®ç­”éƒ½ä¼šâ€œæ¨è¿›æˆ–å¡ä½â€

è¿›åº¦æ˜¯ç¡®å®šæ€§çš„

éå¸¸åˆ©äºæµ‹è¯• & å†™æ—¥å¿—

ä¸‰ã€ç¬¬ä¸‰æ­¥ï¼šåœ¨â€œæ¯è½®æé—®åâ€è§¦å‘è¿›åº¦ï¼ˆæ”¹ app.jsï¼‰

æ–‡ä»¶ï¼š

app

ä½ ç°åœ¨çš„æµç¨‹
ç”¨æˆ·æé—® â†’ AI å›ç­” â†’ æ£€æŸ¥æ˜¯å¦èƒœåˆ©

âœ… æ”¹æˆè¿™æ ·

åœ¨ handleUserSubmit() é‡Œï¼š

const response = await window.aiClient.ask(text);

// æ–°å¢è¿™ä¸€è¡Œ
window.gameLogic.updateProgress(text, response);

// åŸæœ‰é€»è¾‘
appendMessage('ai', response);

ğŸ§  ä¸ºä»€ä¹ˆ

UI ä¸è¯¥ç®—è¿›åº¦

AI ä¸è¯¥ç®—è¿›åº¦

GameLogic æ‰æ˜¯çŠ¶æ€ä¸­å¿ƒ

ğŸ¯ æ•ˆæœ

è¿›åº¦é€»è¾‘â€œè‡ªåŠ¨è¿è¡Œâ€

ä¸å½±å“ç°æœ‰åŠŸèƒ½

ææ˜“æ‰©å±•

å››ã€ç¬¬å››æ­¥ï¼šæŠŠâ€œæç¤ºâ€å±•ç¤ºå‡ºæ¥ï¼ˆæ”¹ index.htmlï¼‰

æ–‡ä»¶ï¼š

index

åœ¨ Game Panel é‡ŒåŠ ä¸€ä¸ªæç¤ºåŒº
<div id="hint-panel" class="story-card hidden">
  <h3>ğŸ§© ç³»ç»Ÿæç¤º</h3>
  <ul id="hint-list"></ul>
</div>


æ”¾åœ¨ story-card ä¸‹é¢å³å¯ã€‚

åœ¨ app.js é‡Œæ¸²æŸ“æç¤º
function renderHints() {
  const hintList = document.getElementById('hint-list');
  hintList.innerHTML = '';

  const spec = window.gameLogic.currentStory.solutionSpec;
  spec.hints.forEach(h => {
    if (window.gameLogic.progress.unlockedHints.has(h.id)) {
      const li = document.createElement('li');
      li.textContent = h.text;
      hintList.appendChild(li);
    }
  });
}


å¹¶åœ¨ updateProgress åè°ƒç”¨ã€‚

ğŸ¯ æ•ˆæœ

ç©å®¶æ„Ÿè§‰åˆ°â€œæˆ‘åœ¨æ¨è¿›â€

ä¸ä¼šè¢«ç›´æ¥å‰§é€

æ¸¸æˆæ›´åƒçœŸäººä¸»æŒ

äº”ã€ç¬¬äº”æ­¥ï¼ˆè¿›é˜¶ï¼‰ï¼šç”¨ AI æ¥åˆ¤å®šè¿›åº¦ï¼ˆæ”¹ ai_client.jsï¼‰

è¿™æ˜¯å¯é€‰ä½†éå¸¸åŠ åˆ†çš„ã€‚

ä½ å¯ä»¥åŠ ä¸€ä¸ªæ–¹æ³•ï¼š

async judgeProgress(question, truth, milestones) {
  const prompt = `
  åˆ¤æ–­é—®é¢˜æ˜¯å¦è§¦åŠä»¥ä¸‹å…³é”®äº‹å®ï¼Œä»…è¿”å› JSONï¼š
  ${JSON.stringify(milestones)}
  é—®é¢˜ï¼š${question}
  `;
  return await this.chatClient.chat(prompt);
}


ç„¶ååœ¨ GameLogic.updateProgress é‡Œç”¨å®ƒã€‚

ğŸ‘‰ è¿™æ˜¯ â€œAgent SDK + Tool/åˆ¤å®šèƒ½åŠ›â€ çš„ä½“ç°ç‚¹
